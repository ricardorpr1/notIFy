<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Certificado IFMG</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    input, button {
      margin: 5px;
      padding: 10px;
      border-radius: 5px;
      width: 250px;
    }
    .btns {
      display: flex;
      justify-content: space-between;
    }
    .btns button {
      background: #4caf50;
      border: none;
      color: white;
      cursor: pointer;
      flex: 1;
      margin: 5px;
    }
    .btns button:hover {
      background: #45a049;
    }
  </style>
</head>
<body>

<form id="formCertificado">
  <h2>Gerar Certificado IFMG</h2>
  <input type="text" id="nome" placeholder="Nome Completo" required><br>
  <input type="text" id="cpf" placeholder="CPF" required><br>
  <input type="text" id="evento" placeholder="Nome do Evento" required><br>
  <label>Data do Evento:</label>
  <input type="date" id="data" required><br>
  <label>Hora Início:</label>
  <input type="time" id="hora_inicio" required><br>
  <label>Hora Fim:</label>
  <input type="time" id="hora_fim" required><br>
  <div class="btns">
    <button type="button" onclick="gerarCertificado('palestrante')">Sou Palestrante</button>
    <button type="button" onclick="gerarCertificado('organizador')">Sou Organizador</button>
    <button type="button" onclick="gerarCertificado('participante')">Sou Participante</button>
  </div>
</form>

<script>
function gerarCertificado(funcao) {
  const nome = document.getElementById("nome").value;
  const cpf = document.getElementById("cpf").value;
  const evento = document.getElementById("evento").value;
  const data = document.getElementById("data").value;
  const horaInicio = document.getElementById("hora_inicio").value;
  const horaFim = document.getElementById("hora_fim").value;

  if (!nome || !cpf || !evento || !data || !horaInicio || !horaFim) {
    alert("Preencha todos os campos!");
    return;
  }

  // Calcula horas
  const inicio = new Date(`1970-01-01T${horaInicio}:00`);
  const fim = new Date(`1970-01-01T${horaFim}:00`);
  const diff = (fim - inicio) / (1000 * 60 * 60);
  const totalHoras = diff.toFixed(1);

  // Formata data
  const partes = data.split("-");
  const dataFormatada = `${partes[2]}/${partes[1]}/${partes[0]}`;

  // Gera hash simples
  const hash = Math.random().toString(36).substring(2, 10).toUpperCase();

  // Texto dinâmico
  let texto = "";
  if (funcao === "palestrante") {
    texto = `Certificamos que ${nome}, CPF ${cpf}, palestrou no(a) ${evento}, no dia ${dataFormatada}, promovido pelo Instituto Federal de Educação, Ciência e Tecnologia de Minas Gerais-campus OURO BRANCO, perfazendo um total de ${totalHoras}h.`;
  } else if (funcao === "organizador") {
    texto = `Certificamos que ${nome}, CPF ${cpf}, colaborou na organização do(a) ${evento}, no dia ${dataFormatada}, promovido pelo Instituto Federal de Educação, Ciência e Tecnologia de Minas Gerais-campus OURO BRANCO, perfazendo um total de ${totalHoras}h.`;
  } else {
    texto = `Certificamos que ${nome}, CPF ${cpf}, participou do(a) ${evento}, no dia ${dataFormatada}, promovido pelo Instituto Federal de Educação, Ciência e Tecnologia de Minas Gerais-campus OURO BRANCO, perfazendo um total de ${totalHoras}h.`;
  }

  // Gera PDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: "landscape", unit: "mm", format: "a4" });

  const img = new Image();
  img.src = "certificado-base.png"; // fundo do certificado
  img.onload = () => {
    doc.addImage(img, "PNG", 0, 0, 297, 210);

    const pageWidth = doc.internal.pageSize.getWidth();

    // Adiciona título IFMG
    doc.setFont("helvetica", "bold");
    doc.setFontSize(22);
    doc.text("INSTITUTO FEDERAL Minas Gerais", pageWidth / 2, 60, { align: "center" });

    doc.setFontSize(18);
    doc.text("CERTIFICADO", pageWidth / 2, 75, { align: "center" });

    const textoFormatado = doc.splitTextToSize(texto, pageWidth - 40);
    doc.setFont("helvetica", "normal");
    doc.setFontSize(14);
    doc.text(textoFormatado, 20, 120);

    doc.setFontSize(10);
    doc.text("Código de Verificação: " + hash, 20, 200);

    doc.save("certificado-ifmg.pdf");
  };
}
</script>

</body>
</html>
